# Aè‚¡è‚¡ç¥¨é¢„æµ‹è½¯ä»¶

ä¸€ä¸ªç”¨äºè·å–å’Œåˆ†æAè‚¡è‚¡ç¥¨æ•°æ®çš„Pythoné¡¹ç›®ï¼Œæ”¯æŒè·å–æ¯æ—¥Kçº¿æ•°æ®å’Œåˆ†é’Ÿçº§è¡Œæƒ…æ•°æ®ã€‚

## é¡¹ç›®ç»“æ„

```
ai_stock/
â”œâ”€â”€ data/                    # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ daily/              # æ¯æ—¥Kçº¿æ•°æ®
â”‚   â””â”€â”€ minute/             # åˆ†é’Ÿçº§è¡Œæƒ…æ•°æ®
â”œâ”€â”€ models/                 # AIæ¨¡å‹æ–‡ä»¶
â”‚   â”œâ”€â”€ trained/            # è®­ç»ƒå¥½çš„æ¨¡å‹æ–‡ä»¶
â”‚   â””â”€â”€ checkpoints/        # è®­ç»ƒæ£€æŸ¥ç‚¹
â”œâ”€â”€ src/                    # æºä»£ç 
â”‚   â”œâ”€â”€ data_fetcher.py    # æ•°æ®è·å–ä¸»æ¨¡å—
â”‚   â”œâ”€â”€ models/            # æ¨¡å‹å®šä¹‰å’Œè®­ç»ƒä»£ç 
â”‚   â””â”€â”€ utils.py           # å·¥å…·å‡½æ•°
â”œâ”€â”€ notebooks/             # Jupyter notebooksï¼ˆæ•°æ®åˆ†æï¼‰
â”œâ”€â”€ main.py                # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt       # ä¾èµ–åŒ…
â””â”€â”€ README.md             # è¯´æ˜æ–‡æ¡£
```

## åŠŸèƒ½ç‰¹æ€§

- âœ… è·å–å…¨éƒ¨Aè‚¡è‚¡ç¥¨åˆ—è¡¨
- âœ… æ‰¹é‡ä¸‹è½½æ¯æ—¥Kçº¿æ•°æ®ï¼ˆæ”¯æŒè‡ªå®šä¹‰æ—¶é—´èŒƒå›´ï¼‰
- âœ… æ‰¹é‡ä¸‹è½½åˆ†é’Ÿçº§è¡Œæƒ…æ•°æ®ï¼ˆ1/5/15/30/60åˆ†é’Ÿï¼‰
- âœ… æ•°æ®è‡ªåŠ¨ä¿å­˜ä¸ºCSVæ ¼å¼
- âœ… æ”¯æŒæŒ‡å®šè‚¡ç¥¨ä»£ç åˆ—è¡¨
- âœ… è¿›åº¦æ¡æ˜¾ç¤ºä¸‹è½½è¿›åº¦
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… **æ™ºèƒ½å¢é‡æ›´æ–°**ï¼šè‡ªåŠ¨æ£€æµ‹å·²æœ‰æ•°æ®ï¼Œåªæ›´æ–°ç¼ºå¤±éƒ¨åˆ†
- âœ… **æ•°æ®èåˆ**ï¼šè‡ªåŠ¨åˆå¹¶å†å²æ•°æ®ï¼Œé¿å…é‡å¤
- âœ… **å®šæœŸæ›´æ–°**ï¼šæ”¯æŒæ¯æ—¥å®šæ—¶æ›´æ–°æœ€æ–°æ•°æ®

## å®‰è£…

### 1. å®‰è£…Minicondaï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰

**æ–¹æ³•Aï¼šä½¿ç”¨è‡ªåŠ¨å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼Œæ— éœ€Homebrewï¼‰**
```bash
cd /Users/mac/Documents/workspace/ai_stock
./install_miniconda.sh
```

**æ–¹æ³•Bï¼šæ‰‹åŠ¨ä¸‹è½½å®‰è£…**
- è®¿é—® https://docs.conda.io/en/latest/miniconda.html
- ä¸‹è½½ macOS ç‰ˆæœ¬çš„ `.pkg` æ–‡ä»¶
- åŒå‡»å®‰è£…
- è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ `INSTALL_CONDA.md`

### 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

```bash
cd /Users/mac/Documents/workspace/ai_stock
./setup_conda_env.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨é…ç½®æ¸…åæºé•œåƒï¼ˆåŠ é€Ÿä¸‹è½½ï¼‰ï¼Œå¦‚æœç½‘ç»œè¾ƒæ…¢å»ºè®®ä½¿ç”¨ã€‚

**æ‰‹åŠ¨é…ç½®æ¸…åæºï¼ˆå¯é€‰ï¼‰:**
```bash
./configure_conda_channels.sh
# é€‰æ‹©é€‰é¡¹ 1 æ·»åŠ æ¸…åæº
```

### 3. æ¿€æ´»ç¯å¢ƒå¹¶å®‰è£…ä¾èµ–

```bash
conda activate env/stock
pip install -r requirements.txt
```

**æ³¨æ„**: å¦‚æœpipå®‰è£…è¾ƒæ…¢ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…é•œåƒï¼š
```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

## ä½¿ç”¨æ–¹æ³•

### 1. æµ‹è¯•æ¨¡å¼ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰

è·å–å‰3åªè‚¡ç¥¨çš„æ•°æ®ä½œä¸ºæµ‹è¯•ï¼š
```bash
python main.py --mode test
```

### 2. è·å–æ¯æ—¥æ•°æ®

è·å–å…¨éƒ¨Aè‚¡æœ€è¿‘1å¹´çš„æ¯æ—¥æ•°æ®ï¼š
```bash
python main.py --mode daily
```

è·å–æŒ‡å®šè‚¡ç¥¨çš„æ•°æ®ï¼š
```bash
python main.py --mode daily --stocks 000001 000002 600000
```

è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´ï¼š
```bash
python main.py --mode daily --start-date 20230101 --end-date 20231231
```

### 3. è·å–åˆ†é’Ÿçº§æ•°æ®

è·å–å…¨éƒ¨Aè‚¡æœ€è¿‘7å¤©çš„1åˆ†é’Ÿæ•°æ®ï¼š
```bash
python main.py --mode minute
```

è·å–5åˆ†é’ŸKçº¿æ•°æ®ï¼š
```bash
python main.py --mode minute --period 5
```

è·å–æœ€è¿‘3å¤©çš„åˆ†é’Ÿçº§æ•°æ®ï¼š
```bash
python main.py --mode minute --minute-days 3
```

### 4. åŒæ—¶è·å–ä¸¤ç§æ•°æ®

```bash
python main.py --mode both
```

### 5. æ™ºèƒ½å¢é‡æ›´æ–°ï¼ˆæ¨èï¼‰

ä½¿ç”¨æ™ºèƒ½æ›´æ–°å™¨ï¼Œæ”¯æŒé‡å¤è¿è¡Œï¼Œåªæ›´æ–°ç¼ºå¤±çš„æ•°æ®ï¼š

#### é¦–æ¬¡è¿è¡Œ - åˆå§‹åŒ–å…¨éƒ¨æ•°æ®ï¼š
```bash
python smart_data_updater.py
```

#### æµ‹è¯•æ¨¡å¼ï¼ˆå‰10åªè‚¡ç¥¨ï¼‰ï¼š
```bash
python smart_data_updater.py --test
```

#### æ›´æ–°æŒ‡å®šæ•°é‡è‚¡ç¥¨ï¼š
```bash
python smart_data_updater.py --max-stocks 100
```

#### æ¯æ—¥å®šæ—¶æ›´æ–°ï¼ˆæ¨èï¼‰ï¼š
```bash
# æ¯å¤©æ—©ä¸Š9:30è‡ªåŠ¨æ›´æ–°ï¼ˆæ·»åŠ åˆ°crontabï¼‰
30 9 * * 1-5 env/stock/bin/python smart_data_updater.py
```

## å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--mode` | è¿è¡Œæ¨¡å¼: daily/minute/both/test | test |
| `--stocks` | æŒ‡å®šè‚¡ç¥¨ä»£ç åˆ—è¡¨ | å…¨éƒ¨Aè‚¡ |
| `--start-date` | å¼€å§‹æ—¥æœŸ (YYYYMMDD) | æœ€è¿‘1å¹´ |
| `--end-date` | ç»“æŸæ—¥æœŸ (YYYYMMDD) | ä»Šå¤© |
| `--days` | è·å–æœ€è¿‘Nå¤©çš„æ¯æ—¥æ•°æ® | 365 |
| `--minute-days` | è·å–æœ€è¿‘Nå¤©çš„åˆ†é’Ÿçº§æ•°æ® | 7 |
| `--period` | åˆ†é’Ÿçº§æ•°æ®å‘¨æœŸ (1/5/15/30/60) | 1 |

## æ•°æ®æ ¼å¼

### æ¯æ—¥æ•°æ® (CSV)

æ–‡ä»¶å‘½åï¼š`{è‚¡ç¥¨ä»£ç }_daily.csv`

åŒ…å«å­—æ®µï¼š
- æ—¥æœŸ
- å¼€ç›˜
- æ”¶ç›˜
- æœ€é«˜
- æœ€ä½
- æˆäº¤é‡
- æˆäº¤é¢
- æŒ¯å¹…
- æ¶¨è·Œå¹…
- æ¶¨è·Œé¢
- æ¢æ‰‹ç‡

### åˆ†é’Ÿçº§æ•°æ® (CSV)

æ–‡ä»¶å‘½åï¼š`{è‚¡ç¥¨ä»£ç }_minute.csv`

åŒ…å«å­—æ®µï¼š
- æ—¶é—´
- å¼€ç›˜
- æ”¶ç›˜
- æœ€é«˜
- æœ€ä½
- æˆäº¤é‡
- æˆäº¤é¢

## ç¼–ç¨‹æ¥å£

### åŸºç¡€APIä½¿ç”¨

ä¹Ÿå¯ä»¥ç›´æ¥åœ¨Pythonä»£ç ä¸­ä½¿ç”¨ï¼š

```python
from src.data_fetcher import StockDataFetcher

# åˆå§‹åŒ–
fetcher = StockDataFetcher()

# è·å–è‚¡ç¥¨åˆ—è¡¨
stock_list = fetcher.get_stock_list()

# è·å–å•åªè‚¡ç¥¨çš„æ¯æ—¥æ•°æ®
df = fetcher.fetch_daily_data("000001", "20230101", "20231231")
fetcher.save_daily_data("000001", df)

# è·å–å•åªè‚¡ç¥¨çš„åˆ†é’Ÿçº§æ•°æ®
df = fetcher.fetch_minute_data("000001", days=7)
fetcher.save_minute_data("000001", df)

# æ‰¹é‡è·å–å…¨éƒ¨Aè‚¡çš„æ¯æ—¥æ•°æ®
fetcher.fetch_all_daily_data()

# æ‰¹é‡è·å–å…¨éƒ¨Aè‚¡çš„åˆ†é’Ÿçº§æ•°æ®
fetcher.fetch_all_minute_data()
```

### æ™ºèƒ½æ›´æ–°å™¨API

```python
from smart_data_updater import SmartStockDataUpdater

# åˆå§‹åŒ–æ›´æ–°å™¨
updater = SmartStockDataUpdater()

# æ›´æ–°æ‰€æœ‰è‚¡ç¥¨ï¼ˆä»2024-01-01åˆ°ä»Šå¤©ï¼‰
updater.update_all_stocks()

# æ›´æ–°æŒ‡å®šæ•°é‡è‚¡ç¥¨ï¼ˆæµ‹è¯•ç”¨ï¼‰
updater.update_all_stocks(max_stocks=10)

# æ£€æŸ¥å•åªè‚¡ç¥¨çŠ¶æ€
status = updater.check_data_status("000001")
print(f"æœ€æ–°æ—¥æœŸ: {status['daily_latest_date']}")
print(f"éœ€è¦æ›´æ–°: {status['daily_needs_update']}")
```

## ç›¸å…³æ–‡æ¡£

- ğŸ“– [`daily_update_guide.md`](daily_update_guide.md) - æ¯æ—¥æ›´æ–°ç­–ç•¥è¯¦ç»†è¯´æ˜
- ğŸ“– [`data_organization_guide.md`](data_organization_guide.md) - æ•°æ®ç»„ç»‡æ–¹å¼æŒ‡å—
- ğŸ”§ [`daily_update_strategy.py`](daily_update_strategy.py) - æ›´æ–°ç­–ç•¥æ¼”ç¤ºä»£ç 

## æ³¨æ„äº‹é¡¹

1. **APIé™æµ**ï¼šç¨‹åºå·²å†…ç½®å»¶æ—¶æœºåˆ¶ï¼ˆ0.5ç§’/è¯·æ±‚ï¼‰ï¼Œé¿å…è§¦å‘APIé™æµ
2. **æ•°æ®é‡**ï¼šè·å–å…¨éƒ¨Aè‚¡æ•°æ®éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå»ºè®®åˆ†æ‰¹ä¸‹è½½æˆ–ä½¿ç”¨æµ‹è¯•æ¨¡å¼
3. **ç½‘ç»œè¿æ¥**ï¼šç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®šï¼Œéƒ¨åˆ†APIå¯èƒ½éœ€è¦è®¿é—®å¤–ç½‘
4. **æ•°æ®æ›´æ–°**ï¼šåˆ†é’Ÿçº§æ•°æ®é€šå¸¸åªèƒ½è·å–æœ€è¿‘å‡ å¤©çš„æ•°æ®
5. **å­˜å‚¨ç©ºé—´**ï¼šå…¨éƒ¨Aè‚¡æ•°æ®å ç”¨ç©ºé—´è¾ƒå¤§ï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´

## æ•°æ®æº

- **akshare**: ç”¨äºè·å–è‚¡ç¥¨åˆ—è¡¨å’ŒKçº¿æ•°æ®
- **ä¸œæ–¹è´¢å¯ŒAPI**: é€šè¿‡akshareæ¥å£è·å–åˆ†é’Ÿçº§è¡Œæƒ…æ•°æ®

## å·¥å…·å¯¹æ¯”

| å·¥å…· | é€‚ç”¨åœºæ™¯ | æ›´æ–°ç­–ç•¥ | é‡å¤è¿è¡Œ | æ•°æ®èåˆ |
|------|----------|----------|----------|----------|
| `main.py` | ä¸€æ¬¡æ€§æ‰¹é‡ä¸‹è½½ | è¦†ç›–å†™å…¥ | ä¸æ”¯æŒ | æ—  |
| `smart_data_updater.py` | **æŒç»­æ›´æ–°ç»´æŠ¤** | **æ™ºèƒ½å¢é‡** | **æ”¯æŒ** | **è‡ªåŠ¨èåˆ** |

## æ™ºèƒ½æ›´æ–°å™¨ç‰¹æ€§

### ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿
- **è‡ªåŠ¨æ£€æµ‹æ›´æ–°éœ€æ±‚**ï¼šæ£€æŸ¥æ¯åªè‚¡ç¥¨çš„æ•°æ®çŠ¶æ€
- **ç²¾ç¡®å¢é‡æ›´æ–°**ï¼šåªä¸‹è½½ç¼ºå¤±çš„æ—¥æœŸèŒƒå›´
- **æ™ºèƒ½æ•°æ®èåˆ**ï¼šè‡ªåŠ¨åˆå¹¶å†å²æ•°æ®ï¼Œé¿å…é‡å¤
- **æ”¯æŒé‡å¤è¿è¡Œ**ï¼šå¯ä»¥å®‰å…¨åœ°å¤šæ¬¡è¿è¡Œ
- **è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š**ï¼šæ˜¾ç¤ºæ›´æ–°è¿›åº¦å’Œç»“æœ

### ğŸ“Š æ›´æ–°é€»è¾‘
```python
# 1. æ£€æŸ¥ç°æœ‰æ•°æ®çŠ¶æ€
status = check_data_status(stock_code)

# 2. è®¡ç®—éœ€è¦æ›´æ–°çš„èŒƒå›´
start_date, end_date = calculate_update_range(stock_code)

# 3. åªè·å–ç¼ºå¤±çš„æ•°æ®
new_data = fetch_missing_data(start_date, end_date)

# 4. åˆå¹¶åˆ°å†å²æ•°æ®
merge_daily_data(stock_code, new_data)
```

### ğŸ’¡ æ¨èä½¿ç”¨æ¨¡å¼

#### 1. åˆå§‹æ•°æ®è·å–
```bash
# é¦–æ¬¡è¿è¡Œï¼Œè·å–æ‰€æœ‰å†å²æ•°æ®
python smart_data_updater.py --max-stocks 100  # å…ˆæµ‹è¯•100åª
python smart_data_updater.py                  # å…¨éƒ¨è·å–
```

#### 2. æ¯æ—¥ç»´æŠ¤æ›´æ–°
```bash
# è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼Œæ¯å¤©æ›´æ–°æœ€æ–°æ•°æ®
crontab -e
# æ·»åŠ ï¼š30 9 * * 1-5 cd /path/to/ai_stock && env/stock/bin/python smart_data_updater.py
```

#### 3. æ‰‹åŠ¨æ›´æ–°æ£€æŸ¥
```bash
# éšæ—¶æ£€æŸ¥å’Œæ›´æ–°
python smart_data_updater.py --test  # å¿«é€Ÿæ£€æŸ¥å‰10åª
```

## åç»­å¼€å‘

- [x] æ·»åŠ æ•°æ®æ›´æ–°åŠŸèƒ½ï¼ˆå¢é‡æ›´æ–°ï¼‰
- [ ] æ”¯æŒæ•°æ®åº“å­˜å‚¨
- [ ] æ·»åŠ æ•°æ®å¯è§†åŒ–åŠŸèƒ½
- [ ] å®ç°AIæ¨¡å‹è®­ç»ƒå’Œé¢„æµ‹
- [ ] æ·»åŠ æ•°æ®è´¨é‡æ£€æŸ¥

## è®¸å¯è¯

MIT License

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

